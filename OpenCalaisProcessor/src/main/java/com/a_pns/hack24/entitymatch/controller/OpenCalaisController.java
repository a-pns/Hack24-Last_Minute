package com.a_pns.hack24.entitymatch.controller;

import java.util.Arrays;
import java.util.Iterator;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Component
public class OpenCalaisController {

	@Autowired
	private RestTemplate HTTPClient;

	private String openCalaisApiUrl = "https://api.thomsonreuters.com/permid/calais";
	// Content-Type - mandatory
	private String contentType = "text/html";
	// outputFormat
	private String outputFormat = "application/json";
	// x-ag-access-token - mandatory
	private String xAgAccessToken = "qikmMMCy8qF1muU89uZJV2O5fFAlELnd";
	// x-calais-language
	private String xCalaisLanguage = "English";
	// x-calais-selectiveTags
	private String xCaliasSelectiveTags = "";
	
	///// MOre info API
	private String moreInfoApiURL = "http://localhost:8081";
	

	@RequestMapping(name = "/", method = RequestMethod.POST)
	public ResponseEntity<String> parseContentAndReturnInformation(@RequestBody String body) throws JSONException {
		//JSONObject calais = sendOpenCalaisRequest(body);
		JSONObject calais = new JSONObject("{\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/9\":{\"score\":0.763,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"G:A\",\"name\":\"Europe\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/8\":{\"score\":0.935,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"M:V\",\"name\":\"Science\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/7\":{\"score\":0.562,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"G:5M\",\"name\":\"France\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/6\":{\"score\":0.524,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"B:148\",\"name\":\"Healthcare (TRBC)\"},\"http:\\/\\/d.opencalais.com\\/comphash-1\\/f84ed738-508b-3909-926b-935bcc439dd2\":{\"confidencelevel\":\"0.575\",\"_typeGroup\":\"entities\",\"nationality\":\"N\\/A\",\"instances\":[{\"detection\":\"[increase in post-booster secondary response for ]IgG[ but not IgM antibodies implying the generation]\",\"offset\":1029,\"prefix\":\"increase in post-booster secondary response for \",\"exact\":\"IgG\",\"length\":3,\"suffix\":\" but not IgM antibodies implying the generation\"}],\"forenduserdisplay\":\"false\",\"confidence\":{\"statisticalfeature\":\"0.905\",\"dblookup\":\"0.0\",\"resolution\":\"0.7749556\",\"aggregate\":\"0.575\"},\"_type\":\"Company\",\"name\":\"IgG\",\"resolutions\":[{\"score\":0.7749556,\"ticker\":\"799\",\"commonname\":\"IGG\",\"ispublic\":\"true\",\"name\":\"IGG INC\",\"permid\":\"5040266870\",\"primaryric\":\"0799.HK\",\"id\":\"https:\\/\\/permid.org\\/1-5040266870\"}],\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/Company\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/comphash-1\\/a95d8edf-9070-3dea-8005-1ca2716f9a83\":{\"confidencelevel\":\"0.466\",\"_typeGroup\":\"entities\",\"nationality\":\"N\\/A\",\"instances\":[{\"detection\":\"[dichroism (CD) spectra were measured for ]LigB7[, LigB10, and LigB10-B7-B7. The molar]\",\"offset\":181,\"prefix\":\"dichroism (CD) spectra were measured for \",\"exact\":\"LigB7\",\"length\":5,\"suffix\":\", LigB10, and LigB10-B7-B7. The molar\"},{\"detection\":\"[LigB domain ( Figure 7?figure supplement 2 ). ]LigB7[, LigB10, and LigB10-B7-B7 boosters were able to]\",\"offset\":720,\"prefix\":\"LigB domain ( Figure 7?figure supplement 2 ). \",\"exact\":\"LigB7\",\"length\":5,\"suffix\":\", LigB10, and LigB10-B7-B7 boosters were able to\"},{\"detection\":\"[sera was also reactive with wild-type ]LigB7[ and LigB10 but failed to react with the negative]\",\"offset\":873,\"prefix\":\"sera was also reactive with wild-type \",\"exact\":\"LigB7\",\"length\":5,\"suffix\":\" and LigB10 but failed to react with the negative\"},{\"detection\":\"[when compared to bacterial loads from wild-type ]LigB7[ or LigB10 immunized hamsters. The immunized]\",\"offset\":1915,\"prefix\":\"when compared to bacterial loads from wild-type \",\"exact\":\"LigB7\",\"length\":5,\"suffix\":\" or LigB10 immunized hamsters. The immunized\"},{\"detection\":\"[from PBS group, all other hamsters from PBS, ]LigB7[ and LigB10 immunization groups presented severe]\",\"offset\":2189,\"prefix\":\"from PBS group, all other hamsters from PBS, \",\"exact\":\"LigB7\",\"length\":5,\"suffix\":\" and LigB10 immunization groups presented severe\"}],\"forenduserdisplay\":\"false\",\"confidence\":{\"statisticalfeature\":\"0.805\",\"dblookup\":\"0.0\",\"resolution\":\"0.0\",\"aggregate\":\"0.466\"},\"_type\":\"Company\",\"name\":\"LigB7\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/Company\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/c44d1871-5e78-32e4-aa92-0c5ccf41ffd8\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[secondary response for IgG but not IgM ]antibodies[ implying the generation of a typical immune]\",\"offset\":1045,\"prefix\":\"secondary response for IgG but not IgM \",\"exact\":\"antibodies\",\"length\":10,\"suffix\":\" implying the generation of a typical immune\"},{\"detection\":\"[). The serological tests indicate that targeted ]antibodies[ can be effectively generated by vaccines based]\",\"offset\":1195,\"prefix\":\"). The serological tests indicate that targeted \",\"exact\":\"antibodies\",\"length\":10,\"suffix\":\" can be effectively generated by vaccines based\"}],\"forenduserdisplay\":\"false\",\"_type\":\"Technology\",\"name\":\"antibodies\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/Technology\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/d2b2dce1-0063-36d2-9956-75a408055741\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[sterilizing immunity for the animals from ]leptospiral infection[.\\n <\\/body>]\",\"offset\":3453,\"prefix\":\"sterilizing immunity for the animals from \",\"exact\":\"leptospiral infection\",\"length\":21,\"suffix\":\".\\n <\\/body>\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"leptospiral infection\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/bdba3a99-0f05-399a-a13a-e0b93d66961f\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[livers were infiltrated by various ]inflammatory cells[, indicating moderate to severe hepatitis. Focal]\",\"offset\":2622,\"prefix\":\"livers were infiltrated by various \",\"exact\":\"inflammatory cells\",\"length\":18,\"suffix\":\", indicating moderate to severe hepatitis. Focal\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"inflammatory cells\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/1\":{\"score\":1,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"name\":\"Health_Medical_Pharma\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/5\":{\"socialTag\":\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/5492360a-1834-353f-bc2d-a25ca9aa581d\",\"_typeGroup\":\"socialTag\",\"forenduserdisplay\":\"true\",\"importance\":\"2\",\"name\":\"Market liquidity\",\"originalValue\":\"Market liquidity\",\"id\":\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/5\"},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/a92ab781-4646-3185-bf6e-d16294fc8278\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[studies were tested for the ability of the ]immunizations[ to generate an effective humoral response using]\",\"offset\":451,\"prefix\":\"studies were tested for the ability of the \",\"exact\":\"immunizations\",\"length\":13,\"suffix\":\" to generate an effective humoral response using\"},{\"detection\":\"[et al., 2000 ). The hamster group that received ]immunizations[ containing recombinant chimeric protein,]\",\"offset\":1742,\"prefix\":\"et al., 2000 ). The hamster group that received \",\"exact\":\"immunizations\",\"length\":13,\"suffix\":\" containing recombinant chimeric protein,\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalTreatment\",\"name\":\"immunizations\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalTreatment\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/f7017617-b166-3727-a488-d71cf6f35ea9\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[inflammatory cells, indicating moderate to ]severe hepatitis[. Focal necrosis was also found in parenchymal]\",\"offset\":2665,\"prefix\":\"inflammatory cells, indicating moderate to \",\"exact\":\"severe hepatitis\",\"length\":16,\"suffix\":\". Focal necrosis was also found in parenchymal\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"severe hepatitis\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/3\":{\"socialTag\":\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/412d2c87-2ead-391a-ae44-6add965d8ada\",\"_typeGroup\":\"socialTag\",\"forenduserdisplay\":\"true\",\"importance\":\"1\",\"name\":\"Economy\",\"originalValue\":\"Economy\",\"id\":\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/3\"},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/2e060906-be28-3a36-92a0-2382ef117e12\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[cells, indicating moderate to severe hepatitis. ]Focal necrosis[ was also found in parenchymal hepatocytes,]\",\"offset\":2683,\"prefix\":\"cells, indicating moderate to severe hepatitis. \",\"exact\":\"Focal necrosis\",\"length\":14,\"suffix\":\" was also found in parenchymal hepatocytes,\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"Focal necrosis\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/4\":{\"socialTag\":\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/310ae903-1683-3f36-90e4-e53d9e45ab9d\",\"_typeGroup\":\"socialTag\",\"forenduserdisplay\":\"true\",\"importance\":\"2\",\"name\":\"Whole-life cost\",\"originalValue\":\"Whole-life cost\",\"id\":\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/4\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/5\":{\"score\":0.417,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"G:7K\",\"name\":\"Netherlands\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/1\":{\"socialTag\":\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/651afa9f-3c26-3b99-a116-4a406015a329\",\"_typeGroup\":\"socialTag\",\"forenduserdisplay\":\"true\",\"importance\":\"1\",\"name\":\"FO\",\"originalValue\":\"FO\",\"id\":\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/1\"},\"http:\\/\\/d.opencalais.com\\/comphash-1\\/e2d7f50c-a437-31f9-9abf-cbe32ef9b356\":{\"confidencelevel\":\"0.457\",\"_typeGroup\":\"entities\",\"nationality\":\"N\\/A\",\"instances\":[{\"detection\":\"[ ). Except for one apparently normal hamster from ]PBS[ group, all other hamsters from PBS, LigB7 and]\",\"offset\":2149,\"prefix\":\" ). Except for one apparently normal hamster from \",\"exact\":\"PBS\",\"length\":3,\"suffix\":\" group, all other hamsters from PBS, LigB7 and\"},{\"detection\":\"[hamster from PBS group, all other hamsters from ]PBS[, LigB7 and LigB10 immunization groups presented]\",\"offset\":2184,\"prefix\":\"hamster from PBS group, all other hamsters from \",\"exact\":\"PBS\",\"length\":3,\"suffix\":\", LigB7 and LigB10 immunization groups presented\"}],\"forenduserdisplay\":\"false\",\"confidence\":{\"statisticalfeature\":\"0.782\",\"dblookup\":\"0.0\",\"resolution\":\"0.037565637\",\"aggregate\":\"0.457\"},\"_type\":\"Company\",\"name\":\"PBS\",\"resolutions\":[{\"score\":0.037565637,\"ticker\":\"BORBRK3\",\"commonname\":\"PBS\",\"ispublic\":\"true\",\"name\":\"PRIVREDNA BANKA SARAJEVO d.d. SARAJEVO\",\"permid\":\"5000635186\",\"primaryric\":\"BORB.SJ\",\"id\":\"https:\\/\\/permid.org\\/1-5000635186\"}],\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/Company\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/4\":{\"score\":0.358,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"B:229\",\"name\":\"Metals & Mining\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/2\":{\"socialTag\":\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/fc91f002-de4e-3596-9d22-a7767fce0d3c\",\"_typeGroup\":\"socialTag\",\"forenduserdisplay\":\"true\",\"importance\":\"1\",\"name\":\"Asset management\",\"originalValue\":\"Asset management\",\"id\":\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/SocialTag\\/2\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/3\":{\"score\":0.273,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"B:279\",\"name\":\"Technology Equipment\"},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/cat\\/2\":{\"score\":0.636,\"_typeGroup\":\"topics\",\"forenduserdisplay\":\"false\",\"rcscode\":\"M:P\",\"name\":\"Health \\/ Medicine\"},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/f1fe674a-5fc1-349f-84ef-7d5273e21609\":{\"company_affiliate\":\"http:\\/\\/d.opencalais.com\\/comphash-1\\/6c52e2c1-bad9-3455-b2d8-d2e2cf53a34d\",\"affiliaterelationtype\":\"groups\",\"_typeGroup\":\"relations\",\"instances\":[{\"detection\":\"[from PBS group, all other hamsters from PBS, ]LigB7 and LigB10 immunization groups[ presented severe clinical signs and prominent]\",\"offset\":2189,\"prefix\":\"from PBS group, all other hamsters from PBS, \",\"exact\":\"LigB7 and LigB10 immunization groups\",\"length\":36,\"suffix\":\" presented severe clinical signs and prominent\"}],\"forenduserdisplay\":\"true\",\"company_parent\":\"http:\\/\\/d.opencalais.com\\/comphash-1\\/a95d8edf-9070-3dea-8005-1ca2716f9a83\",\"_type\":\"CompanyAffiliates\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/r\\/CompanyAffiliates\"},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/d5667076-d851-3840-8b10-0a062a857f39\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[lesions on spirochete-targeted organs (]e.g. multifocal pulmonary ecchymoses[, icteric liver and enlarged kidney). Lung]\",\"offset\":2323,\"prefix\":\"lesions on spirochete-targeted organs (\",\"exact\":\"e.g. multifocal pulmonary ecchymoses\",\"length\":36,\"suffix\":\", icteric liver and enlarged kidney). Lung\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"e.g. multifocal pulmonary ecchymoses\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/fdd11b74-01c5-355b-9ae6-5a10e7a4bc75\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[analysis for LigB Ig-like domains utilized in ]immunization[ trials.\\n(A) Far-UV circular dichroism (CD)]\",\"offset\":99,\"prefix\":\"analysis for LigB Ig-like domains utilized in \",\"exact\":\"immunization\",\"length\":12,\"suffix\":\" trials.\\n(A) Far-UV circular dichroism (CD)\"},{\"detection\":\"[with the negative control, LigB12. LigB10-B7-B7 ]immunization[ led to an increase in post-booster secondary]\",\"offset\":958,\"prefix\":\"with the negative control, LigB12. LigB10-B7-B7 \",\"exact\":\"immunization\",\"length\":12,\"suffix\":\" led to an increase in post-booster secondary\"},{\"detection\":\"[kidney, and urinary bladder tissue from all ]immunization[ groups were examined by real-time quantitative]\",\"offset\":1483,\"prefix\":\"kidney, and urinary bladder tissue from all \",\"exact\":\"immunization\",\"length\":12,\"suffix\":\" groups were examined by real-time quantitative\"},{\"detection\":\"[all other hamsters from PBS, LigB7 and LigB10 ]immunization[ groups presented severe clinical signs and]\",\"offset\":2206,\"prefix\":\"all other hamsters from PBS, LigB7 and LigB10 \",\"exact\":\"immunization\",\"length\":12,\"suffix\":\" groups presented severe clinical signs and\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalTreatment\",\"name\":\"immunization\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalTreatment\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/d377fcfd-df1c-3b8b-97de-d4b7a79aede8\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[Levett et al., 2005 ; Haake et al., 2000 ). The ]hamster group[ that received immunizations containing]\",\"offset\":1714,\"prefix\":\"Levett et al., 2005 ; Haake et al., 2000 ). The \",\"exact\":\"hamster group\",\"length\":13,\"suffix\":\" that received immunizations containing\"}],\"forenduserdisplay\":\"false\",\"_type\":\"IndustryTerm\",\"name\":\"hamster\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/IndustryTerm\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/ad70db71-5141-3f04-ad9f-9a0d158c3067\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[loss of normal tissue integrity ( Figure 7D ). ]Severe tubulointerstitial nephritis[ with locally extensive hemorrhage in uriniferous]\",\"offset\":2799,\"prefix\":\"loss of normal tissue integrity ( Figure 7D ). \",\"exact\":\"Severe tubulointerstitial nephritis\",\"length\":35,\"suffix\":\" with locally extensive hemorrhage in uriniferous\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"Severe tubulointerstitial nephritis\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/ComponentVersions\":{\"_typeGroup\":\"versions\",\"version\":[\"DIY-Categorization-fnr-TRCS-prcng_3:20171117095241:20171117095241\",\"DIY-Categorization-fnr-TRCS-curint-News:20180221133342:20180221133342\",\"DIY-Categorization-fnr-TRCS-capx:20170627191152:20170627191152\",\"DIY-Categorization-fnr-TRCS-cstcut_new-News:20180301140156:20180301140156\",\"DIY-Categorization-fnr-TRCS-margnu:20171117095324:20171117095324\",\"Deals Index:201803101550:201803101550\",\"DIY-Categorization-fnr-TRCS-indx_stsale:20170323110805:20170323110805\",\"DIY-Categorization-tms-TRCS-sanity_tms_auto_publish-News:20180204121630:20180204121630\",\"DIY-Categorization-fnr-TRCS-comptn:20170621141739:20170621141739\",\"index-refineries:201803031930:201803031930\",\"DIY-Categorization-fnr-TRCS-regs_buyb_new:20170509091609:20170509091609\",\"config-physicalAssets-powerStations:698:698\",\"NextTags:OneCalais_11.3-RELEASE:201\",\"SpanishIM:OneCalais_11.3-RELEASE:30\",\"DIY-Categorization-fnr-TRCS-infl-News:20180206095852:20180206095852\",\"DIY-Categorization-fnr-TRCS-newjbs:20180124163802:20180124163802\",\"DIY-Categorization-fnr-TRCS-dis:20170418132337:20170418132337\",\"DIY-Categorization-fnr-TRCS-revdrv2-News:20180202125843:20180202125843\",\"DIY-Categorization-fnr-TRCS-splitb_r1:20170329082516:20170329082516\",\"DIY-Categorization-fnr-TRCS-esgenv_2-News:20180202131300:20180202131300\",\"DIY-Categorization-fnr-TRCS-margnd_2:20171117095121:20171117095121\",\"config-sca-DataPackage:50:50\",\"config-companyNe:752:752\",\"DIY-Categorization-fnr-TRCS-acb:20170502102348:20170502102348\",\"DIY-Categorization-fnr-TRCS-stsale_new-News:20180302131833:20180302131833\",\"DIY-Categorization-tms-TRCS-auto_publish_qa:20171113140947:20171113140947\",\"DIY-Categorization-fnr-TRCS-levrge:20170621122109:20170621122109\",\"DIY-Categorization-fnr-TRCS-hedge_list1:20170625000000:20170625000000\",\"SECHeaderMetadataIM:OneCalais_11.3-RELEASE:30\",\"DIY-Categorization-fnr-TRCS-esggov-News:20180301091656:20180301091656\",\"DIY-Categorization-fnr-TRCS-sales1:20171219091829:20171219091829\",\"config-refreshableDIY:1:1\",\"DIY-Categorization-fnr-TRCS-crycur:20171121113558:20171121113558\",\"DIY-Categorization-fnr-TRCS-rmrmrg:20171204112525:20171204112525\",\"DIY-Categorization-fnr-TRCS-capital_expenditure_rama_rch2-Research:20180305132538:20180305132538\",\"DIY-Categorization-fnr-TRCS-frxrte:20171229123536:20171229123536\",\"DIY-Categorization-support-TRCS-test_mike2-News:20180211085925:20180211085925\",\"People Index:201803101455:201803101455\",\"DIY-Categorization-fnr-TRCS-awlq:20170331124441:20170331124441\",\"DIY-Categorization-tms-TRCS-training_f_upload1508077143269:20171031131216:20171031131216\",\"config-negativeSignature:698:698\",\"DIY-Categorization-fnr-TRCS-fake1_monop_bnkcap_new:20170405133257:20170405133257\",\"Dial4J:OneCalais_11.3-RELEASE:30\",\"AutocoderRuntimeIM:OneCalais_11.3-RELEASE:30\",\"DIY-Categorization-fnr-TRCS-dbtr_new:20170315123740:20170315123740\",\"DIY-Categorization-fnr-TRCS-scale_2:20171130072915:20171130072915\",\"OA Override:752:752\",\"DIY-Categorization-fnr-TRCS-hrgt:20170427081548:20170427081548\",\"DIY-Categorization-fnr-TRCS-xpand:20170323144646:20170323144646\",\"DIY-Categorization-fnr-TRCS-kycterror-News:20180223164257:20180223164257\",\"DIY-Categorization-fnr-TRCS-leverage_ratios_rama_rch-Research:20180305132725:20180305132725\",\"DIY-Categorization-fnr-TRCS-bonus_share_issues_sai_rch-Research:20180305132618:20180305132618\",\"DIY-Categorization-fnr-TRCS-resass-News:20180208130324:20180208130324\",\"DIY-Categorization-fnr-TRCS-allcemrgdvst2:20170424130000:20170424130000\",\"DIY-Categorization-fnr-TRCS-ordr:20170313151239:20170313151239\",\"People Override:698:698\",\"DIY-Categorization-fnr-TRCS-hrgt_recll:20170522120000:20170522120000\",\"index-company-oa3:201803100500:201803100500\",\"index-vessels:201803032340:201803032340\",\"DIY-Categorization-fnr-TRCS-brib_r1:20170329090629:20170329090629\",\"DIY-Categorization-fnr-TRCS-cvalu:20171212133524:20171212133524\",\"BrokerResearchIM:OneCalais_11.3-RELEASE:30\",\"config-forEndUserDisplay:3:3\",\"config-refineries:698:698\",\"DIY-Categorization-fnr-TRCS-prdlch-News:20180201133354:20180201133354\",\"DIY-Categorization-fnr-TRCS-fapm:20170713144316:20170713144316\",\"DIY-Categorization-fnr-TRCS-class:20170315123207:20170315123207\",\"config-cse:747:747\",\"OneCalaisIM:OneCalais_11.3-RELEASE:30\",\"DIY-Categorization-fnr-TRCS-isu_dat_r:20170405124144:20170405124144\",\"DIY-Categorization-fnr-TRCS-cnsl_sisu:20170321144134:20170321144134\",\"DIY-Categorization-fnr-TRCS-newjbs-News:20180123114120:20180123114120\",\"DIY-Categorization-fnr-TRCS-shract_r1:20170412111808:20170412111808\",\"config-vessels:698:698\",\"OneCalais:OneCalais_11.3-RELEASE:201\",\"DIY-Categorization-fnr-TRCS-invtry_09_25_2017:20171120093416:20171120093416\",\"DIY-Categorization-fnr-TRCS-mktshr2:20170705120412:20170705120412\",\"DIY-RCS-fnr-TRCS-cavs:4:4\",\"DIY-Categorization-fnr-TRCS-divestitures_spin_offs_rash_rch-Research:20180305132659:20180305132659\",\"DIY-Categorization-fnr-TRCS-news_corpus:20180117160412:20180117160412\",\"DIY-Categorization-fnr-TRCS-blktrd_r1:20171116075645:20171116075645\",\"DIY-Categorization-fnr-TRCS-trd_tax:20170309132522:20170309132522\",\"DIY-Categorization-fnr-TRCS-sov_2:20170522130956:20170522130956\",\"DIY-Categorization-fnr-TRCS-bons:20170406103713:20170406103713\",\"DIY-Categorization-fnr-TRCS-sanity_pre_r1_1:20180117161124:20180117161124\",\"DIY-Categorization-fnr-TRCS-blkchn_4-News:20180123105513:20180123105513\",\"DIY-Categorization-fnr-TRCS-segrev:20171117133125:20171117133125\",\"DIY-Categorization-fnr-TRCS-hrgt_namec:20170329090731:20170329090731\",\"DIY-RCS-fnr-TRCS-nd:3:3\",\"DIY-Categorization-fnr-TRCS-stx:20170530123138:20170530123138\",\"DIY-Categorization-fnr-TRCS-pmi-News:20180214153232:20180214153232\",\"config-physicalAssets-mines:698:698\",\"SocialTags Index:201803050435:201803050435\",\"BlackList:747:747\",\"DIY-Categorization-fnr-TRCS-shpmnt_new2:20171116121809:20171116121809\",\"DIY-Categorization-fnr-TRCS-crptax:20171117095403:20171117095403\",\"index-ports:201803031920:201803031920\",\"FrenchIM:OneCalais_11.3-RELEASE:30\",\"config-physicalAssets-ports:698:698\",\"DIY-Categorization-fnr-TRCS-ream:20170529065740:20170529065740\",\"DIY-Categorization-fnr-TRCS-chld:20170524084254:20170524084254\",\"DIY-Categorization-fnr-TRCS-allce:20170323145654:20170323145654\",\"DIY-Categorization-fnr-TRCS-medreg:20170508120210:20170508120210\",\"config-drugs:698:698\",\"DIY-Categorization-fnr-TRCS-exrsks:20171129184952:20171129184952\"]},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/Industry\\/2\":{\"_typeGroup\":\"industry\",\"forenduserdisplay\":\"false\",\"rcscode\":\"B:1810\",\"trbccode\":\"5720103016\",\"name\":\"Internet Gaming\",\"permid\":\"4294951191\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/6fb550e4-529a-3e26-9718-1956b60ecc94\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[by lymphoplasmacytic cells infiltration and ]severe fibrosis[. In contrast, all hamsters immunized with]\",\"offset\":3075,\"prefix\":\"by lymphoplasmacytic cells infiltration and \",\"exact\":\"severe fibrosis\",\"length\":15,\"suffix\":\". In contrast, all hamsters immunized with\"}],\"forenduserdisplay\":\"false\",\"_type\":\"MedicalCondition\",\"name\":\"severe fibrosis\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/MedicalCondition\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/Industry\\/1\":{\"_typeGroup\":\"industry\",\"forenduserdisplay\":\"false\",\"rcscode\":\"B:1615\",\"trbccode\":\"5510101010\",\"name\":\"Banks - NEC\",\"permid\":\"4294951386\",\"relevance\":0.2},\"http:\\/\\/d.opencalais.com\\/genericHasher-1\\/ba0c2205-6a82-375c-9ddf-3cc3b9615228\":{\"_typeGroup\":\"entities\",\"instances\":[{\"detection\":\"[all other hamsters from PBS, LigB7 and LigB10 ]immunization groups[ presented severe clinical signs and prominent]\",\"offset\":2206,\"prefix\":\"all other hamsters from PBS, LigB7 and LigB10 \",\"exact\":\"immunization groups\",\"length\":19,\"suffix\":\" presented severe clinical signs and prominent\"}],\"forenduserdisplay\":\"false\",\"_type\":\"IndustryTerm\",\"name\":\"immunization groups\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/IndustryTerm\",\"relevance\":0.2},\"doc\":{\"meta\":{\"serverVersion\":\"OneCalais_11.3-RELEASE:201\",\"signature\":\"digestalg-1|lle6BpqYTcf7eUVUqcifscFc6dA=|TkK8G+NB7RGohus\\/qhFSvXGAQaZ9zs+hnlApU2phYEhV1eCFMo+1sQ==\",\"stagsVer\":\"OneCalais_11.3-RELEASE-b2-2017-12-20_12:00:23\",\"submissionDate\":\"2018-03-10 17:06:55.564\",\"language\":\"English\",\"submitterCode\":\"2362b867-7324-6cab-fb2e-2a48761bfb77\",\"contentType\":\"text\\/html\",\"processingVer\":\"AllMetadata\"},\"info\":{\"docId\":\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\",\"document\":\"<body> Download asset Open asset\\nSecondary structure analysis for LigB Ig-like domains utilized in immunization trials.\\n(A) Far-UV circular dichroism (CD) spectra were measured for LigB7, LigB10, and LigB10-B7-B7. The molar ellipticity, ?, was measured from 200 nm to 240 nm for 10 ?M of each protein at room ?\\nsee more\\nhttps:\\/\\/doi.org\\/10.7554\\/eLife.30051.023\\nSerological fluids collected during the hamster studies were tested for the ability of the immunizations to generate an effective humoral response using a direct ELISA binding assay. The sera from LigB domain immunized hamsters provided a strong antibody response against the corresponding immobilized recombinant LigB domain ( Figure 7?figure supplement 2 ). LigB7, LigB10, and LigB10-B7-B7 boosters were able to further enhance the antibody response. The Anti-LigB10-B7-B7 sera was also reactive with wild-type LigB7 and LigB10 but failed to react with the negative control, LigB12. LigB10-B7-B7 immunization led to an increase in post-booster secondary response for IgG but not IgM antibodies implying the generation of a typical immune memory response ( Figure 7?figure supplement 3 ). The serological tests indicate that targeted antibodies can be effectively generated by vaccines based on individual LigB Ig-like domains and chimeric domains.\\nSeveral complementary methods were employed to test for the vaccine?s ability to reduce bacterial burdens of host tissue. Liver, kidney, and urinary bladder tissue from all immunization groups were examined by real-time quantitative reverse transcription polymerase chain reaction (RT-qPCR) to identify the Leptospira specific gene, LipL32 ( Figure 7B ) ( Levett et al., 2005 ; Haake et al., 2000 ). The hamster group that received immunizations containing recombinant chimeric protein, LigB10-B7-B7, exhibited a significant reduction in leptospiral burden when compared to bacterial loads from wild-type LigB7 or LigB10 immunized hamsters. The immunized hamsters were further examined for histopathologic changes of livers, kidneys and lungs ( Figure 7C?H and Figure 7?figure supplement 4 ). Except for one apparently normal hamster from PBS group, all other hamsters from PBS, LigB7 and LigB10 immunization groups presented severe clinical signs and prominent macroscopic lesions on spirochete-targeted organs (e.g. multifocal pulmonary ecchymoses, icteric liver and enlarged kidney). Lung lesions included thickening of alveolar septa due to edema, interstitial leukocytes infiltration, endothelial cell swelling, and extensive hemorrhage ( Figure 7C ). Leptospira-infected livers were infiltrated by various inflammatory cells, indicating moderate to severe hepatitis. Focal necrosis was also found in parenchymal hepatocytes, leading to loss of normal tissue integrity ( Figure 7D ). Severe tubulointerstitial nephritis with locally extensive hemorrhage in uriniferous spaces and tubules was present in Leptospira-infected kidneys ( Figure 7E ). Furthermore, greater than 50% of renal tubules were lost and replaced by lymphoplasmacytic cells infiltration and severe fibrosis. In contrast, all hamsters immunized with chimeric LigB10-B7-B7 presented no visible macroscopic\\/microscopic lesions in livers, kidneys or lungs ( Figure 7F?H ). In agreement with high survival rate of LigB10-B7-B7 immunized hamsters, vaccines containing the chimeric antigen provide superior protection and potentially sterilizing immunity for the animals from leptospiral infection.\\n <\\/body>\",\"docTitle\":\"\",\"docDate\":\"2018-03-10 17:06:56.265\",\"id\":\"http:\\/\\/id.opencalais.com\\/97I6c2auRJ82BCAoSIlP8g\",\"calaisRequestID\":\"1f86da3f-9e81-c876-1621-0e12dcc7c2bd\",\"ontology\":\"http:\\/\\/mdaas-virtual-onecalais.int.thomsonreuters.com\\/owlschema\\/11.3\\/onecalais.owl.allmetadata.xml\"}},\"http:\\/\\/d.opencalais.com\\/dochash-1\\/1f88c30f-476b-35ff-b203-059561c075df\\/lid\\/DefaultLangId\":{\"_typeGroup\":\"language\",\"forenduserdisplay\":\"false\",\"permid\":\"505062\",\"language\":\"http:\\/\\/d.opencalais.com\\/lid\\/DefaultLangId\\/English\"},\"http:\\/\\/d.opencalais.com\\/comphash-1\\/6c52e2c1-bad9-3455-b2d8-d2e2cf53a34d\":{\"confidencelevel\":\"0.579\",\"_typeGroup\":\"entities\",\"nationality\":\"N\\/A\",\"instances\":[{\"detection\":\"[dichroism (CD) spectra were measured for LigB7, ]LigB10[, and LigB10-B7-B7. The molar ellipticity, ?, was]\",\"offset\":188,\"prefix\":\"dichroism (CD) spectra were measured for LigB7, \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\", and LigB10-B7-B7. The molar ellipticity, ?, was\"},{\"detection\":\"[spectra were measured for LigB7, LigB10, and ]LigB10[-B7-B7. The molar ellipticity, ?, was measured]\",\"offset\":200,\"prefix\":\"spectra were measured for LigB7, LigB10, and \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7. The molar ellipticity, ?, was measured\"},{\"detection\":\"[domain ( Figure 7?figure supplement 2 ). LigB7, ]LigB10[, and LigB10-B7-B7 boosters were able to further]\",\"offset\":727,\"prefix\":\"domain ( Figure 7?figure supplement 2 ). LigB7, \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\", and LigB10-B7-B7 boosters were able to further\"},{\"detection\":\"[7?figure supplement 2 ). LigB7, LigB10, and ]LigB10[-B7-B7 boosters were able to further enhance the]\",\"offset\":739,\"prefix\":\"7?figure supplement 2 ). LigB7, LigB10, and \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7 boosters were able to further enhance the\"},{\"detection\":\"[further enhance the antibody response. The Anti-]LigB10[-B7-B7 sera was also reactive with wild-type]\",\"offset\":822,\"prefix\":\"further enhance the antibody response. The Anti-\",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7 sera was also reactive with wild-type\"},{\"detection\":\"[sera was also reactive with wild-type LigB7 and ]LigB10[ but failed to react with the negative control,]\",\"offset\":883,\"prefix\":\"sera was also reactive with wild-type LigB7 and \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\" but failed to react with the negative control,\"},{\"detection\":\"[to react with the negative control, LigB12. ]LigB10[-B7-B7 immunization led to an increase in]\",\"offset\":945,\"prefix\":\"to react with the negative control, LigB12. \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7 immunization led to an increase in\"},{\"detection\":\"[containing recombinant chimeric protein, ]LigB10[-B7-B7, exhibited a significant reduction in]\",\"offset\":1797,\"prefix\":\"containing recombinant chimeric protein, \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7, exhibited a significant reduction in\"},{\"detection\":\"[to bacterial loads from wild-type LigB7 or ]LigB10[ immunized hamsters. The immunized hamsters were]\",\"offset\":1924,\"prefix\":\"to bacterial loads from wild-type LigB7 or \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\" immunized hamsters. The immunized hamsters were\"},{\"detection\":\"[group, all other hamsters from PBS, LigB7 and ]LigB10[ immunization groups presented severe clinical]\",\"offset\":2199,\"prefix\":\"group, all other hamsters from PBS, LigB7 and \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\" immunization groups presented severe clinical\"},{\"detection\":\"[contrast, all hamsters immunized with chimeric ]LigB10[-B7-B7 presented no visible]\",\"offset\":3142,\"prefix\":\"contrast, all hamsters immunized with chimeric \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7 presented no visible\"},{\"detection\":\"[7F?H ). In agreement with high survival rate of ]LigB10[-B7-B7 immunized hamsters, vaccines containing]\",\"offset\":3293,\"prefix\":\"7F?H ). In agreement with high survival rate of \",\"exact\":\"LigB10\",\"length\":6,\"suffix\":\"-B7-B7 immunized hamsters, vaccines containing\"}],\"forenduserdisplay\":\"false\",\"confidence\":{\"statisticalfeature\":\"0.88\",\"dblookup\":\"0.0\",\"resolution\":\"0.0\",\"aggregate\":\"0.579\"},\"_type\":\"Company\",\"name\":\"LigB10\",\"_typeReference\":\"http:\\/\\/s.opencalais.com\\/1\\/type\\/em\\/e\\/Company\",\"relevance\":0.8}}");
		JSONObject entities = parseResponseToGetEntities(calais);
		JSONObject entityInformation = sendInfoGatheringRequest(entities);
		String taggedHtml = processHtmlAddTags(body, entities.getJSONArray("entities"));
		JSONObject jsonResponse = createResponse(taggedHtml, entityInformation);
		return new ResponseEntity<String>(jsonResponse.toString(), HttpStatus.OK);
	}

	public JSONObject sendOpenCalaisRequest(String content) throws JSONException {
		HttpEntity entity;
		HttpHeaders headers = new HttpHeaders();
		headers.add("Content-Type", contentType);
		headers.add("outputFormat", outputFormat);
		headers.add("x-ag-access-token", xAgAccessToken);
		headers.add("x-calais-language", xCalaisLanguage);

		entity = new HttpEntity<>(content, headers);

		ResponseEntity<String> response = HTTPClient.postForEntity(openCalaisApiUrl, entity, String.class);
		JSONObject json = new JSONObject(response.getBody());
		return json;
	}

	public JSONObject parseResponseToGetEntities(JSONObject response) throws JSONException {
		JSONObject responseJson = new JSONObject();
		JSONArray arrayOfEntities = new JSONArray();
		Iterator responseKeys = response.keys();
		int indexNum = 0;
		while (responseKeys.hasNext()) {
			String key = (String) responseKeys.next();
			if (response.get(key) != null
					&& "entities".equals(response.getJSONObject(key).opt("_typeGroup"))
					&& Arrays.asList("MedicalCondition", "MedicalTreatment")
					.contains(response.getJSONObject(key).opt("_type"))) {
				JSONObject entity = response.getJSONObject(key);
				JSONArray instances = entity.getJSONArray("instances");
				String name = entity.getString("name");
				String type = entity.getString("_type");

				JSONObject newEntity = new JSONObject();
				JSONArray prefixes = new JSONArray();
				JSONArray suffixes = new JSONArray();
				for (int i = 0; i < instances.length(); i++) {
					{
						JSONObject tmpJsonObj = instances.getJSONObject(i);
						prefixes.put(tmpJsonObj.getString("prefix"));
						suffixes.put(tmpJsonObj.getString("suffix"));
					}

					newEntity.put("name", name);
					newEntity.put("type", type);
					newEntity.put("textBeforeRefs", prefixes);
					newEntity.put("textAfterRefs", suffixes);
					newEntity.put("tag", "entity" + indexNum);
					arrayOfEntities.put(newEntity);
					indexNum++;
				}
			}
		}
		responseJson.put("entities", arrayOfEntities);
		return responseJson;
	}
	
	public JSONObject sendInfoGatheringRequest(JSONObject entities) throws JSONException
	{
		System.out.println(entities.toString());
		HttpEntity entity;
		HttpHeaders headers = new HttpHeaders();
		entity = new HttpEntity<>(entities.toString(), headers);

		//ResponseEntity<String> response = HTTPClient.postForEntity(moreInfoApiURL, entity, String.class);
		// Waiting for charles' code so mocking info
		//JSONObject json = new JSONObject(response.getBody());
		// Mocking returnedData
		JSONObject json = new JSONObject();
		JSONObject item1 = new JSONObject();
		item1.put("name", "health");
		JSONObject item1Info = new JSONObject();
		item1Info.put("summary", "this is a summary");
		JSONArray item1Array = new JSONArray();
		item1Array.put("www.elife.com");
		item1.put("eLife Articles", item1Array);
		item1.put("tag", "entity1");
		json.put(item1.getString("tag"),item1);
		JSONObject item2 = new JSONObject();
		item2.put("name", "health");
		JSONObject item2Info = new JSONObject();
		item2Info.put("summary", "this is a summary");
		JSONArray item2Array = new JSONArray();
		item2Array.put("www.wikipedia.com");
		item2.put("Wiki Page", item2Array);
		item2.put("tag", "entity2");
		json.put(item2.getString("tag"),item2);
		
		return json;
	}
	
	public String processHtmlAddTags(String content, JSONArray entities) throws JSONException
	{
		String className = "entity";
		for (int i = 0; i < entities.length(); i++)
		{
			JSONObject entity = entities.getJSONObject(i);
			JSONArray prefixes = entity.getJSONArray("textBeforeRefs");
			JSONArray suffixes = entity.getJSONArray("textAfterRefs");
			for (int prefixIndex = 0; prefixIndex < prefixes.length(); prefixIndex++)
			{
				content = content.replace(
						prefixes.getString(prefixIndex) + entity.getString("name") + suffixes.getString(prefixIndex)
						,
						prefixes.getString(prefixIndex) + "<span class=\""+className + i + "\">" + entity.getString("name") + "</span>" + suffixes.getString(prefixIndex));
			}
		}
		content = content.replace("\r\n", "");
		return content;
	}
	public JSONObject createResponse(String html, JSONObject entityInformation) throws JSONException
	{
		JSONObject json = new JSONObject();
		json.put("html", html);
		json.put("entities", entityInformation);
		return json;
	}
}
